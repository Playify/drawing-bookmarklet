!function(){document.sdmcd=!document.sdmcd;let e,t,n,d,s,o,a,c=5,l="#FF0000",r=!1,u=!1,m=!1,h=!1,p=[],g=[],f=[],b=0,x=!1,y=!1,v=!1;function w(){z(),document.sdmcdKeyAborter.abort(),document.getElementById("sdmcd-canvas")?.remove(),document.getElementById("sdmcd-popup-bg")?.remove();for(const e of document.getElementsByClassName("sdmcd-text-input"))e.remove()}function F(e){e.preventDefault()}function I(e){document.getElementById("sdmcd-popup-bg")||e.target.classList.contains("sdmcd-text-input")||(0!==e.button&&void 0!==e.button||(a.lineWidth=c,a.globalCompositeOperation="source-over",T(),r=!0),2===e.button&&(a.lineWidth=Math.max(c,30),v?(a.fillStyle="#FFFFFF",a.strokeStyle="#FFFFFF",a.globalCompositeOperation="source-over"):a.globalCompositeOperation="destination-out",u=!0,R()),1===e.button?(!function(e,t){const n=document.createElement("div");n.contentEditable=!0,n.type="text",n.classList.add("sdmcd-text-input"),n.style.color=l,n.style.fontSize=2.5*c+20+"px",n.style.top=t-1.5*c-15+"px",n.style.left=e+"px",n.id="sdmcd-text-input-"+Date.now(),document.body.appendChild(n),n.focus(),n.addEventListener("focus",(()=>{p.push({textId:n.id,text:n.textContent}),g=[]})),n.addEventListener("mousedown",(e=>{2===e.button&&(e.preventDefault(),n.classList.toggle("removed"),p.push({textId:n.id}),g=[])})),p.push({textId:n.id})}(e.clientX,e.clientY),e.preventDefault()):p.push({data:a.getImageData(0,0,o.width,o.height)}),g=[],f.push({x:e.clientX,y:e.clientY}))}function E(e){r&&x&&1===f.length?function(e,t){const n=[[e,t]],d=a.getImageData(0,0,o.width,o.height),s=c(e,t),i=r(l);if(s.r===i.r&&s.g===i.g&&s.b===i.b)return;for(;n.length;){const[e,t]=n.pop();let d=4*(t*o.width+e),s=t;for(;s>=0&&u(d);)s--,d-=4*o.width;d+=4*o.width,s++;let a=!1,i=!1;for(;s<o.height&&u(d);)m(d),e>0&&(u(d-4)?a||(n.push([e-1,s]),a=!0):a&&(a=!1)),e<o.width-1&&(u(d+4)?i||(n.push([e+1,s]),i=!0):i&&(i=!1)),s++,d+=4*o.width}function c(e,t){const n=4*(t*o.width+e);return{r:d.data[n],g:d.data[n+1],b:d.data[n+2],a:d.data[n+3]}}function r(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:255}}function u(e){const t=d.data[e],n=d.data[e+1],o=d.data[e+2],a=d.data[e+3];if(a>0&&a<255)return!0;if(t===s.r&&n===s.g&&o===s.b)return!0;const c=Math.abs(s.r-i.r)/Math.abs(t-s.r),l=Math.abs(s.g-i.g)/Math.abs(n-s.g),r=Math.abs(s.b-i.b)/Math.abs(o-s.b),u=[];return isNaN(c)||u.push(c),isNaN(l)||u.push(l),isNaN(r)||u.push(r),u.length>0&&u.every(((e,t,n)=>e===n[0]))&&1!=u[0]}function m(e){d.data[e]=i.r,d.data[e+1]=i.g,d.data[e+2]=i.b,d.data[e+3]=i.a}a.putImageData(d,0,0)}(e.clientX,e.clientY):k(e),r&&(r=!1),u&&(u=!1,n.classList.add("sdmcd-fading")),f=[]}function k(d){if(n){let e=c;n.classList.contains("sdmcd-erasing")&&(e=Math.max(c,30)),n.style.top=d.clientY-e/2-1+"px",n.style.left=d.clientX-e/2-1+"px"}e=d.clientX,t=d.clientY,(r||u)&&(y=!0,f.push({x:d.clientX,y:d.clientY}),L())}function L(){r?0!==b||x?0===b&&x?(M(),a.beginPath(),a.moveTo(f[0].x,f[0].y),a.lineTo(f[f.length-1].x,f[f.length-1].y),a.stroke()):1!==b||x?1===b&&x?function(){M();const e=f[0].x,t=f[0].y,n=(Math.abs(f[0].x-f[f.length-1].x)+Math.abs(f[0].y-f[f.length-1].y))/2,d=f[0].x<f[f.length-1].x?n:-n,s=f[0].y<f[f.length-1].y?n:-n;a.strokeRect(e,t,d,s)}():2!==b||x?2===b&&x&&function(){M();const e=f[0].x,t=f[0].y,n=Math.min(Math.abs(f[0].x-f[f.length-1].x),Math.abs(f[0].y-f[f.length-1].y))/2,d=f[0].x<f[f.length-1].x?n:-n,s=f[0].y<f[f.length-1].y?n:-n;a.beginPath(),a.ellipse(e+d,t+s,n,n,0,0,2*Math.PI),a.stroke()}():function(){M();const e=Math.min(f[0].x,f[f.length-1].x),t=Math.min(f[0].y,f[f.length-1].y),n=Math.abs(f[0].x-f[f.length-1].x),d=Math.abs(f[0].y-f[f.length-1].y);a.beginPath(),a.ellipse(e+n/2,t+d/2,n/2,d/2,0,0,2*Math.PI),a.stroke()}():function(){M();const e=Math.min(f[0].x,f[f.length-1].x),t=Math.min(f[0].y,f[f.length-1].y),n=Math.abs(f[0].x-f[f.length-1].x),d=Math.abs(f[0].y-f[f.length-1].y);a.strokeRect(e,t,n,d)}():A():u&&A()}function C(e){e.preventDefault(),s&&document.body.contains(s)||(e.deltaY>0?c-=1:c+=1,c<1&&(c=1),a.lineWidth=c,R(),L())}function M(){const e=p[p.length-1].data;a.putImageData(e,0,0)}function A(){if(M(),f.length<4){var e=f[0];a.beginPath(),a.arc(e.x,e.y,a.lineWidth/2,0,2*Math.PI,!0),a.closePath(),a.fill()}else{for(a.beginPath(),a.moveTo(f[0].x,f[0].y),i=1;i<f.length-2;i++){const e=(f[i].x+f[i+1].x)/2,t=(f[i].y+f[i+1].y)/2;a.quadraticCurveTo(f[i].x,f[i].y,e,t)}a.quadraticCurveTo(f[i].x,f[i].y,f[i+1].x,f[i+1].y),a.stroke()}}function D(e){e.preventDefault()}function T(){a.strokeStyle=l,a.fillStyle=l}function B(e){v=!v,a.globalCompositeOperation="source-over";const t=document.querySelectorAll(".sdmcd-text-input:not(.removed)"),n=[...t].map((e=>e.id));t.forEach((e=>e.classList.add("removed"))),v?(e&&p.push({switch:!0,activeTextInputs:n,data:a.getImageData(0,0,o.width,o.height)}),a.fillStyle="#FFFFFF",a.fillRect(0,0,o.width,o.height),l="#000000",T()):(e&&p.push({switch:!0,activeTextInputs:n,data:a.getImageData(0,0,o.width,o.height)}),l="#FF0000",T(),a.clearRect(0,0,o.width,o.height)),g=[]}function S(){document.sdmcdMouseAborter=new AbortController,window.addEventListener("contextmenu",F,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerdown",I,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerup",E,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointermove",k,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("dragstart",D,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("wheel",C,{passive:!1,signal:document.sdmcdMouseAborter.signal}),document.body.style.touchAction="none"}function z(){document.sdmcdMouseAborter.abort(),document.body.style.touchAction="auto"}function R(){n||(n=document.createElement("div"),n.id="sdmcd-brush-outline",document.body.appendChild(n)),n.classList.remove("sdmcd-fading"),u||n.classList.remove("sdmcd-erasing"),clearTimeout(d);let s=c;u&&(s=Math.max(c,30),n.classList.add("sdmcd-erasing")),n.style.top=t-s/2-1+"px",n.style.left=e-s/2-1+"px",n.style.width=s+"px",n.style.height=s+"px",u||(d=setTimeout((()=>{n.classList.add("sdmcd-fading")}),500))}function P(){const e=document.createElement("div");e.id="sdmcd-popup-bg",e.addEventListener("click",(t=>{t.target==e&&e.remove()}));const t=document.createElement("div");return t.id="sdmcd-popup-content",e.appendChild(t),document.body.appendChild(e),s=e,t}document.sdmcd?(!function(){if(document.getElementById("sdmcd-css"))return;const e=document.createElement("style");e.id="sdmcd-css",e.innerHTML="#sdmcd-canvas{position:fixed;top:0;left:0;z-index:9999997;cursor:crosshair}.sdmcd-hidden #sdmcd-canvas,.sdmcd-hidden .sdmcd-text-input,.sdmcd-text-input.removed{display:none}.sdmcd-unfocused #sdmcd-canvas,.sdmcd-unfocused .sdmcd-text-input{pointer-events:none}#sdmcd-popup-bg{position:fixed;top:0;left:0;z-index:9999999;width:100vw;height:100vh;background-color:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;font-size:1vw;color:#fff;font-family:Helvetica,sans-serif}#sdmcd-popup-content{display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}#sdmcd-popup-content.sdmcd-horizontal{flex-direction:row}.sdmcd-help-section{display:flex;flex-direction:column;justify-content:center;align-items:center;width:35em}.sdmcd-help-line{font-size:1.5em;height:1.6em;margin:0;color:#fff}#sdmcd-color-content{font-size:2em;display:flex;flex-direction:column;align-items:center;gap:.2em}#sdmcd-color{width:20em;height:20em;border-radius:1em;padding:0;border:none;outline:0;cursor:pointer;pointer-events:auto}#sdmcd-color::-webkit-color-swatch-wrapper{padding:0}#sdmcd-color::-webkit-color-swatch{border:none;border-radius:.5em}#sdmcd-brush-outline{position:fixed;border-radius:50%;border:1px solid #888;pointer-events:none;z-index:9999998}#sdmcd-brush-outline.sdmcd-fading{opacity:0;transition:opacity .5s}.sdmcd-text-input{position:fixed;z-index:9999998;outline:0;border-right:1px solid transparent;font-family:Arial,Helvetica,sans-serif;font-weight:400}",document.head.appendChild(e)}(),o=document.createElement("canvas"),o.id="sdmcd-canvas",o.width=window.innerWidth,o.height=window.innerHeight,document.body.appendChild(o),a=o.getContext("2d",{willReadFrequently:!0}),a.lineWidth=c,a.lineJoin="round",a.lineCap="round",T(),S(),document.sdmcdKeyAborter=new AbortController,window.addEventListener("keydown",(function(e){let t,n=!0;if(document.activeElement.classList.contains("sdmcd-text-input")&&!e.ctrlKey)return;if(!(!m&&!h||"F1"==e.key&&(m||h)||"f"==e.key&&m))return;x&&(y=!0);"Shift"!==e.key||x||(x=!0,y=!1);if("Escape"===e.key&&document.activeElement.classList.contains("sdmcd-text-input"))return void document.activeElement.blur();switch(e.key){case"Escape":document.getElementById("sdmcd-popup-bg")?document.getElementById("sdmcd-popup-bg").remove():(document.sdmcd=!1,w());break;case"e":p.push({data:a.getImageData(0,0,o.width,o.height)}),v?(a.fillStyle="#FFFFFF",a.fillRect(0,0,o.width,o.height),T()):a.clearRect(0,0,o.width,o.height),g=[];break;case"s":if(e.ctrlKey){const e=o.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="drawing.png",t.click()}else c=5,a.lineWidth=5,R();break;case"w":l="#FFFFFF";break;case"b":l="#000000";break;case"r":l="#FF0000";break;case"g":l="#00FF00";break;case"l":l="#0000FF";break;case"o":l="#FFA500";break;case"p":l="#800080",L();break;case"m":l="#FF00FF";break;case"a":l="#00FFFF";break;case"c":t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=P(),t=document.createElement("div");t.id="sdmcd-color-content",e.appendChild(t);const n=document.createElement("input");n.id="sdmcd-color",n.type="color",n.value=l,n.addEventListener("change",(e=>{l=e.target.value,T()})),t.textContent="Color:",t.appendChild(n)}();break;case"ArrowUp":c+=1,a.lineWidth=c,R();break;case"ArrowDown":c-=1,c<1&&(c=1),a.lineWidth=c,R();break;case"f":m=!m,m?(h=!1,document.body.classList.add("sdmcd-unfocused"),z()):(document.body.classList.remove("sdmcd-unfocused"),S());break;case"F1":h=!h,h?(m=!1,document.body.classList.add("sdmcd-hidden"),document.body.classList.remove("sdmcd-unfocused"),z()):(document.body.classList.remove("sdmcd-hidden"),S());break;case"z":if(e.ctrlKey){const e=a.getImageData(0,0,o.width,o.height),t=p.pop();if(!t)break;if(t.switch&&B(!1),t.data&&a.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.remove("removed")}g.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(g.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(g.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else g.push({data:e,switch:t.switch})}break;case"y":if(!e.ctrlKey){l="#FFFF00";break}{const e=a.getImageData(0,0,o.width,o.height),t=g.pop();if(!t)break;if(t.switch&&B(!1),t.data&&a.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.add("removed")}p.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(p.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(p.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else p.push({data:e,switch:t.switch})}break;case"t":B(!0);break;case"R":b=1;break;case"C":b=2;break;case"h":t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=P(),t=["General:","E - Erase the canvas","Esc - Close modal / Exit drawing mode","","↑ / Scroll up - Increase brush size","↓ / Scroll down - Decrease brush size","S - Reset brush size","","Ctrl + Z - Undo","Ctrl + Y - Redo","T - Toggle between overlay and whiteboard mode","F - Focus page content without hiding drawing","F1 - Hide drawing and focus page content","Ctrl + S - Save drawing as image","","H - Open this help menu"],n=["Colors:","C - Open color picker","","W - White","B - Black","","R - Red","G - Green","L - Blue","","Y - Yellow","O - Orange","P - Purple","M - Magenta","A - Aqua"],d=document.createElement("div");d.classList.add("sdmcd-help-section"),e.appendChild(d);const s=document.createElement("div");s.classList.add("sdmcd-help-section"),e.appendChild(s);for(const e of t){const t=document.createElement("p");t.textContent=e,t.classList.add("sdmcd-help-line"),d.appendChild(t)}for(const e of n){const t=document.createElement("p");t.textContent=e,t.classList.add("sdmcd-help-line"),s.appendChild(t)}e.classList.add("sdmcd-horizontal")}();break;default:n=!1}T(),L(),n&&(e.preventDefault(),e.stopPropagation())}),{capture:!0,signal:document.sdmcdKeyAborter.signal}),window.addEventListener("keyup",(function(e){"Shift"===e.key&&(y||(b=0),x=!1,L())}),{capture:!0,signal:document.sdmcdKeyAborter.signal})):w()}();