!function(){document.sdmcd=!document.sdmcd;let e,t,n,d,a,o,s,c=5,l=5,r="#FF0000",u=!1,m=!1,h=!1,p=!1,g=[],f=[],b=[],x=0,y=!1,v=!1,w=!1;function F(){S(),document.sdmcdKeyAborter.abort(),document.getElementById("sdmcd-canvas")?.remove(),document.getElementById("sdmcd-popup-bg")?.remove();for(const e of document.getElementsByClassName("sdmcd-text-input"))e.remove()}function I(e){e.preventDefault()}function E(e){document.getElementById("sdmcd-popup-bg")||e.target.classList.contains("sdmcd-text-input")||(0!==e.button&&void 0!==e.button||(s.lineWidth=c,s.globalCompositeOperation="source-over",T(),u=!0),2===e.button&&(s.lineWidth=Math.max(1.5*c,30),w?(s.fillStyle="#FFFFFF",s.strokeStyle="#FFFFFF",s.globalCompositeOperation="source-over"):s.globalCompositeOperation="destination-out",m=!0,z()),1===e.button?(!function(e,t){const n=document.createElement("div");n.contentEditable=!0,n.type="text",n.classList.add("sdmcd-text-input"),n.style.color=r,n.style.fontSize=2.5*l+20+"px",n.style.top=t-1.5*l-15+"px",n.style.left=e+"px",n.id="sdmcd-text-input-"+Date.now(),document.body.appendChild(n),n.focus(),n.addEventListener("focus",(()=>{g.push({textId:n.id,text:n.textContent}),f=[]})),n.addEventListener("pointerdown",(e=>{2===e.button&&(e.preventDefault(),n.classList.toggle("removed"),g.push({textId:n.id}),f=[])})),g.push({textId:n.id})}(e.clientX,e.clientY),e.preventDefault()):g.push({data:s.getImageData(0,0,o.width,o.height)}),f=[],b.push({x:e.clientX,y:e.clientY}))}function k(e){u&&y&&1===b.length?function(e,t){const n=g[g.length-1];s.putImageData(n.data,0,0);const d=[[e,t]],a=s.getImageData(0,0,o.width,o.height),i=l(e,t),c=u(r);if(i.r===c.r&&i.g===c.g&&i.b===c.b)return;for(;d.length;){const[e,t]=d.pop();let n=4*(t*o.width+e),a=t;for(;a>=0&&m(n);)a--,n-=4*o.width;n+=4*o.width,a++;let i=!1,s=!1;for(;a<o.height&&m(n);)h(n),e>0&&(m(n-4)?i||(d.push([e-1,a]),i=!0):i&&(i=!1)),e<o.width-1&&(m(n+4)?s||(d.push([e+1,a]),s=!0):s&&(s=!1)),a++,n+=4*o.width}function l(e,t){const n=4*(t*o.width+e);return{r:a.data[n],g:a.data[n+1],b:a.data[n+2],a:a.data[n+3]}}function u(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:255}}function m(e){const t=a.data[e],n=a.data[e+1],d=a.data[e+2],o=a.data[e+3];if(o>0&&o<255)return!0;if(t===i.r&&n===i.g&&d===i.b)return!0;const s=Math.abs(i.r-c.r)/Math.abs(t-i.r),l=Math.abs(i.g-c.g)/Math.abs(n-i.g),r=Math.abs(i.b-c.b)/Math.abs(d-i.b),u=[];return isNaN(s)||u.push(s),isNaN(l)||u.push(l),isNaN(r)||u.push(r),u.length>0&&u.every(((e,t,n)=>e===n[0]))&&1!=u[0]}function h(e){a.data[e]=c.r,a.data[e+1]=c.g,a.data[e+2]=c.b,a.data[e+3]=c.a}s.putImageData(a,0,0)}(e.clientX,e.clientY):L(e),u&&(u=!1),m&&(m=!1,n.classList.add("sdmcd-fading")),b=[]}function L(d){if(n){let e=c;n.classList.contains("sdmcd-erasing")&&(e=Math.max(1.5*c,30)),n.style.top=d.clientY-e/2-1+"px",n.style.left=d.clientX-e/2-1+"px"}e=d.clientX,t=d.clientY,(u||m)&&(v=!0,b.push({x:d.clientX,y:d.clientY}),C())}function C(){u?0!==x||y?0===x&&y?(A(),s.beginPath(),s.moveTo(b[0].x,b[0].y),s.lineTo(b[b.length-1].x,b[b.length-1].y),s.stroke()):1!==x||y?1===x&&y?function(){A();const e=b[0].x,t=b[0].y,n=(Math.abs(b[0].x-b[b.length-1].x)+Math.abs(b[0].y-b[b.length-1].y))/2,d=b[0].x<b[b.length-1].x?n:-n,a=b[0].y<b[b.length-1].y?n:-n;s.strokeRect(e,t,d,a)}():2!==x||y?2===x&&y&&function(){A();const e=b[0].x,t=b[0].y,n=Math.min(Math.abs(b[0].x-b[b.length-1].x),Math.abs(b[0].y-b[b.length-1].y))/2,d=b[0].x<b[b.length-1].x?n:-n,a=b[0].y<b[b.length-1].y?n:-n;s.beginPath(),s.ellipse(e+d,t+a,n,n,0,0,2*Math.PI),s.stroke()}():function(){A();const e=Math.min(b[0].x,b[b.length-1].x),t=Math.min(b[0].y,b[b.length-1].y),n=Math.abs(b[0].x-b[b.length-1].x),d=Math.abs(b[0].y-b[b.length-1].y);s.beginPath(),s.ellipse(e+n/2,t+d/2,n/2,d/2,0,0,2*Math.PI),s.stroke()}():function(){A();const e=Math.min(b[0].x,b[b.length-1].x),t=Math.min(b[0].y,b[b.length-1].y),n=Math.abs(b[0].x-b[b.length-1].x),d=Math.abs(b[0].y-b[b.length-1].y);s.strokeRect(e,t,n,d)}():function(){if(A(),b.length<4){var e=b[0];s.beginPath(),s.arc(e.x,e.y,s.lineWidth/2,0,2*Math.PI,!0),s.closePath(),s.fill()}else{for(s.beginPath(),s.moveTo(b[0].x,b[0].y),i=1;i<b.length-2;i++){const e=(b[i].x+b[i+1].x)/2,t=(b[i].y+b[i+1].y)/2;s.quadraticCurveTo(b[i].x,b[i].y,e,t)}s.quadraticCurveTo(b[i].x,b[i].y,b[i+1].x,b[i+1].y),s.stroke()}}():m&&function(){if(b.length<4){var e=b[0];return s.beginPath(),s.arc(e.x,e.y,s.lineWidth/2,0,2*Math.PI,!0),s.closePath(),void s.fill()}const t=b[b.length-4],n=b[b.length-2],d=b[b.length-1];s.beginPath(),s.moveTo(t.x,t.y),s.quadraticCurveTo(d.x,d.y,n.x,n.y),s.stroke()}()}function M(e){if(e.preventDefault(),document.activeElement.classList.contains("sdmcd-text-input"))return e.deltaY>0?l-=1:l+=1,l<1&&(l=1),void(document.activeElement.style.fontSize=2.5*l+20+"px");e.shiftKey&&(a&&document.body.contains(a)||(e.deltaY>0?c-=1:c+=1,c<1&&(c=1),s.lineWidth=c,l=c,z(),C()))}function A(){const e=g[g.length-1].data;s.putImageData(e,0,0)}function D(e){e.preventDefault()}function T(){s.strokeStyle=r,s.fillStyle=r}function B(e){w=!w,s.globalCompositeOperation="source-over";const t=document.querySelectorAll(".sdmcd-text-input:not(.removed)"),n=[...t].map((e=>e.id));t.forEach((e=>e.classList.add("removed"))),w?(e&&g.push({switch:!0,activeTextInputs:n,data:s.getImageData(0,0,o.width,o.height)}),s.fillStyle="#FFFFFF",s.fillRect(0,0,o.width,o.height),r="#000000",T()):(e&&g.push({switch:!0,activeTextInputs:n,data:s.getImageData(0,0,o.width,o.height)}),r="#FF0000",T(),s.clearRect(0,0,o.width,o.height)),f=[]}function P(){document.sdmcdMouseAborter=new AbortController,window.addEventListener("contextmenu",I,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerdown",E,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerup",k,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointermove",L,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("dragstart",D,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("wheel",M,{passive:!1,signal:document.sdmcdMouseAborter.signal}),document.body.style.touchAction="none"}function S(){document.sdmcdMouseAborter.abort(),document.body.style.touchAction="auto"}function z(){n||(n=document.createElement("div"),n.id="sdmcd-brush-outline",document.body.appendChild(n)),n.classList.remove("sdmcd-fading"),m||n.classList.remove("sdmcd-erasing"),clearTimeout(d);let a=c;m&&(a=Math.max(1.5*c,30),n.classList.add("sdmcd-erasing")),n.style.top=t-a/2-1+"px",n.style.left=e-a/2-1+"px",n.style.width=a+"px",n.style.height=a+"px",m||(d=setTimeout((()=>{n.classList.add("sdmcd-fading")}),500))}function R(){const e=document.createElement("div");e.id="sdmcd-popup-bg",e.addEventListener("click",(t=>{t.target==e&&e.remove()}));const t=document.createElement("div");return t.id="sdmcd-popup-content",e.appendChild(t),document.body.appendChild(e),a=e,t}document.sdmcd?(!function(){if(document.getElementById("sdmcd-css"))return;const e=document.createElement("style");e.id="sdmcd-css",e.innerHTML="#sdmcd-canvas{position:fixed;top:0;left:0;z-index:9999997;cursor:crosshair}.sdmcd-hidden #sdmcd-canvas,.sdmcd-hidden .sdmcd-text-input,.sdmcd-text-input.removed{display:none}.sdmcd-unfocused #sdmcd-canvas,.sdmcd-unfocused .sdmcd-text-input{pointer-events:none}#sdmcd-popup-bg{position:fixed;top:0;left:0;z-index:9999999;width:100vw;height:100vh;background-color:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;font-size:1vw;color:#fff;font-family:Helvetica,sans-serif}#sdmcd-popup-content{display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}#sdmcd-popup-content.sdmcd-horizontal{flex-direction:row}.sdmcd-help-section{display:flex;flex-direction:column;justify-content:center;align-items:center;width:35em}.sdmcd-help-line{font-size:1.5em;height:1.6em;margin:0;color:#fff}#sdmcd-color-content{font-size:2em;display:flex;flex-direction:column;align-items:center;gap:.2em}#sdmcd-color{width:20em;height:20em;border-radius:1em;padding:0;border:none;outline:0;cursor:pointer;pointer-events:auto}#sdmcd-color::-webkit-color-swatch-wrapper{padding:0}#sdmcd-color::-webkit-color-swatch{border:none;border-radius:.5em}#sdmcd-brush-outline{position:fixed;border-radius:50%;border:1px solid #888;pointer-events:none;z-index:9999998}#sdmcd-brush-outline.sdmcd-fading{opacity:0;transition:opacity .5s}.sdmcd-text-input{position:fixed;z-index:9999998;outline:0;border-right:1px solid transparent;font-family:Arial,Helvetica,sans-serif;font-weight:400}",document.head.appendChild(e)}(),o=document.createElement("canvas"),o.id="sdmcd-canvas",o.width=window.innerWidth,o.height=window.innerHeight,document.body.appendChild(o),s=o.getContext("2d",{willReadFrequently:!0}),s.lineWidth=c,s.lineJoin="round",s.lineCap="round",T(),P(),document.sdmcdKeyAborter=new AbortController,window.addEventListener("keydown",(function(e){let t,n=!0;if("Escape"===e.key&&document.activeElement.classList.contains("sdmcd-text-input"))return void document.activeElement.blur();if(document.activeElement.classList.contains("sdmcd-text-input")&&!e.ctrlKey)return;if(!(!h&&!p||"F1"==e.key&&(h||p)||"f"==e.key&&h))return;y&&(v=!0);"Shift"!==e.key||y||(y=!0,v=!1);switch(e.key){case"Escape":document.getElementById("sdmcd-popup-bg")?document.getElementById("sdmcd-popup-bg").remove():(document.sdmcd=!1,F());break;case"e":g.push({data:s.getImageData(0,0,o.width,o.height)}),w?(s.fillStyle="#FFFFFF",s.fillRect(0,0,o.width,o.height),T()):s.clearRect(0,0,o.width,o.height),f=[];break;case"s":if(e.ctrlKey){const e=o.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="drawing.png",t.click()}else c=5,s.lineWidth=5,z();break;case"w":r="#FFFFFF";break;case"b":r="#000000";break;case"r":r="#FF0000";break;case"g":r="#00FF00";break;case"l":r="#0000FF";break;case"o":r="#FFA500";break;case"p":r="#800080",C();break;case"m":r="#FF00FF";break;case"a":r="#00FFFF";break;case"c":if(u||m)break;t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=R(),t=document.createElement("div");t.id="sdmcd-color-content",e.appendChild(t);const n=document.createElement("input");n.id="sdmcd-color",n.type="color",n.value=r,n.addEventListener("change",(e=>{r=e.target.value,T()})),t.textContent="Color:",t.appendChild(n)}();break;case"ArrowUp":c+=1,s.lineWidth=c,l=c,z();break;case"ArrowDown":c-=1,c<1&&(c=1),s.lineWidth=c,l=c,z();break;case"f":h=!h,h?(p=!1,document.body.classList.add("sdmcd-unfocused"),S()):(document.body.classList.remove("sdmcd-unfocused"),P());break;case"F1":p=!p,p?(h=!1,document.body.classList.add("sdmcd-hidden"),document.body.classList.remove("sdmcd-unfocused"),S()):(document.body.classList.remove("sdmcd-hidden"),P());break;case"z":if(e.ctrlKey){const e=s.getImageData(0,0,o.width,o.height),t=g.pop();if(!t)break;if(t.switch&&B(!1),t.data&&s.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.remove("removed")}f.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(f.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(f.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else f.push({data:e,switch:t.switch})}break;case"y":if(!e.ctrlKey){r="#FFFF00";break}{const e=s.getImageData(0,0,o.width,o.height),t=f.pop();if(!t)break;if(t.switch&&B(!1),t.data&&s.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.add("removed")}g.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(g.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(g.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else g.push({data:e,switch:t.switch})}break;case"t":B(!0);break;case"R":x=1;break;case"C":x=2;break;case"h":if(u||m)break;t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=R(),t=["General:","E - Erase the canvas","Esc - Close modal / Exit drawing mode","","↑ / Scroll up - Increase brush size","↓ / Scroll down - Decrease brush size","S - Reset brush size","","Ctrl + Z - Undo","Ctrl + Y - Redo","T - Toggle between overlay and whiteboard mode","F - Focus page content without hiding drawing","F1 - Hide drawing and focus page content","Ctrl + S - Save drawing as image","","H - Open this help menu"],n=["Colors:","C - Open color picker","","W - White","B - Black","","R - Red","G - Green","L - Blue","","Y - Yellow","O - Orange","P - Purple","M - Magenta","A - Aqua"],d=document.createElement("div");d.classList.add("sdmcd-help-section"),e.appendChild(d);const a=document.createElement("div");a.classList.add("sdmcd-help-section"),e.appendChild(a);for(const e of t){const t=document.createElement("p");t.textContent=e,t.classList.add("sdmcd-help-line"),d.appendChild(t)}for(const e of n){const t=document.createElement("p");t.textContent=e,t.classList.add("sdmcd-help-line"),a.appendChild(t)}e.classList.add("sdmcd-horizontal")}();break;default:n=!1}T(),C(),n&&(e.preventDefault(),e.stopPropagation())}),{capture:!0,signal:document.sdmcdKeyAborter.signal}),window.addEventListener("keyup",(function(e){"Shift"===e.key&&(v||(x=0),y=!1,C())}),{capture:!0,signal:document.sdmcdKeyAborter.signal})):F()}();